<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">

<title>SystemtapOnUbuntu - Systemtap Wiki</title>
<script type="text/javascript" src="/moin_static199/common/js/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static199/modern/css/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="/moin_static199/modern/css/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="/moin_static199/modern/css/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="/moin_static199/modern/css/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static199/modern/css/msie.css">
<![endif]-->


<link rel="alternate" title="Systemtap Wiki: SystemtapOnUbuntu" href="/systemtap/wiki/SystemtapOnUbuntu?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=SystemtapOnUbuntu&amp;ddiffs=1" type="application/rss+xml">


<link rel="Start" href="/systemtap/wiki/HomePage">
<link rel="Alternate" title="Wiki Markup" href="/systemtap/wiki/SystemtapOnUbuntu?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/systemtap/wiki/SystemtapOnUbuntu?action=print">
<link rel="Search" href="/systemtap/wiki/FindPage">
<link rel="Index" href="/systemtap/wiki/TitleIndex">
<link rel="Glossary" href="/systemtap/wiki/WordIndex">
<link rel="Help" href="/systemtap/wiki/HelpOnFormatting">
</head>

<body  lang="en" dir="ltr">

<div id="header">
<div id="logo"><a href="/systemtap/wiki/HomePage"><img src="/systemtap/systemtaplogo.png" alt="systemtap wiki"></a></div>

<form id="searchform" method="get" action="/systemtap/wiki/SystemtapOnUbuntu">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>

<ul id="username"><li><a href="/systemtap/wiki/SystemtapOnUbuntu?action=login" id="login" rel="nofollow">Login</a></li></ul>
<div id="locationline">
<div id="interwiki"><span><a href="/systemtap/wiki/HomePage" rel="nofollow">Self</a></span></div>

<ul id="pagelocation">
<li><a href="/systemtap/wiki/SystemtapOnUbuntu">SystemtapOnUbuntu</a></li>
</ul>

</div>


<ul id="navibar">
<li class="wikilink"><a href="/systemtap/wiki/HomePage">HomePage</a></li><li class="wikilink"><a href="/systemtap/wiki/RecentChanges">RecentChanges</a></li><li class="wikilink"><a href="/systemtap/wiki/FindPage">FindPage</a></li><li class="wikilink"><a href="/systemtap/wiki/HelpContents">HelpContents</a></li><li class="current"><a href="/systemtap/wiki/SystemtapOnUbuntu">SystemtapOnUbuntu</a></li>
</ul>

<div id="pageline"><hr style="display:none;"></div>

<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="/systemtap/wiki/SystemtapOnUbuntu?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="/systemtap/wiki/SystemtapOnUbuntu?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/systemtap/wiki/SystemtapOnUbuntu">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>

<div id="page" lang="en" dir="ltr">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><div><table style="&amp;quot; float:right;  font-size: 0.9em;  width:40%;  background:#F1F1ED;  margin: 0 0 1em 1em; &amp;quot;"><tbody><tr>  <td style="&amp;quot; padding:0.5em; &amp;quot;"><p class="line891"><div class="table-of-contents"><p class="table-of-contents-heading">Contents<ol><li>
<a href="#A_guide_on_how_to_install_Systemtap_on_an_Ubuntu_system">A guide on how to install Systemtap on an Ubuntu system</a><ol><li>
<a href="#Distro_Support">Distro Support</a></li><li>
<a href="#Get_the_systemtap_package">Get the systemtap package</a></li><li>
<a href="#Kernel_support">Kernel support</a><ol><li>
<a href="#Debug_Symbols">Debug Symbols</a><ol><li>
<a href="#General_ddeb_repository_configuration">General ddeb repository configuration</a></li><li>
<a href="#Ubuntu_9.10_and_higher">Ubuntu 9.10 and higher</a></li><li>
<a href="#Ubuntu_releases_9.04_and_older">Ubuntu releases 9.04 and older</a></li></ol></li></ol></li><li>
<a href="#Devel_environment">Devel environment</a></li></ol></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867">
<h1 id="A_guide_on_how_to_install_Systemtap_on_an_Ubuntu_system">A guide on how to install Systemtap on an Ubuntu system</h1>
<span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
<h2 id="Distro_Support">Distro Support</h2>
<span class="anchor" id="line-6"></span><ul><li><p class="line891"><a class="https" href="https://wiki.ubuntu.com/Kernel/Systemtap">https://wiki.ubuntu.com/Kernel/Systemtap</a> <span class="anchor" id="line-7"></span></li><li><p class="line891"><a class="https" href="https://launchpad.net/ubuntu/+source/systemtap">Lauchpad systemtap project</a> <span class="anchor" id="line-8"></span></li></ul><p class="line867">
<h2 id="Get_the_systemtap_package">Get the systemtap package</h2>
<span class="anchor" id="line-9"></span><p class="line867"><span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><pre><span class="anchor" id="line-1"></span>sudo apt-get install systemtap</pre><span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">(To build it yourself, see <a class="http" href="http://sourceware.org/git/?p=systemtap.git;a=blob_plain;f=README;hb=HEAD">our README file</a>.) <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">Get access to ddebs containing debug symbols: Follow instructions in <a class="https" href="https://wiki.ubuntu.com/DebuggingProgramCrash">https://wiki.ubuntu.com/DebuggingProgramCrash</a> <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
<h2 id="Kernel_support">Kernel support</h2>
<span class="anchor" id="line-18"></span><p class="line862">The generic kernel comes with CONFIG_DEBUG_FS, CONFIG_DEBUG_KERNEL, CONFIG_DEBUG_INFO and CONFIG_KPROBES enabled, so no recompilation needed. For <strong>Ubuntu Gutsy</strong> (or older version), you have to recompile your kernel: <a class="https" href="https://bugs.launchpad.net/debian/+source/audit/+bug/140784">Bug #140784: Enable CONFIG_AUDITSYSCALL in kernel config</a>. <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><p class="line867">
<h3 id="Debug_Symbols">Debug Symbols</h3>
<span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><p class="line867">
<h4 id="General_ddeb_repository_configuration">General ddeb repository configuration</h4>
<span class="anchor" id="line-23"></span><p class="line867"><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><pre><span class="anchor" id="line-1-1"></span># cat &gt; /etc/apt/sources.list.d/ddebs.list &lt;&lt; EOF
<span class="anchor" id="line-2"></span>deb http://ddebs.ubuntu.com/ precise main restricted universe multiverse
<span class="anchor" id="line-3"></span>EOF
<span class="anchor" id="line-4"></span>
<span class="anchor" id="line-5"></span>etc.
<span class="anchor" id="line-6"></span>
<span class="anchor" id="line-7"></span># apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ECDCAD72428D7C01
<span class="anchor" id="line-8"></span># apt-get update</pre><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><p class="line867"><strong>NOTE:</strong> Ubuntu kernel packages carry a sub-version field that does not show up in <em>uname -r</em>, so there may occur <span class="anchor" id="line-36"></span>subtle installation errors whereby the -dbgsym appears correct, but doesn't exactly match the kernel image running.  For <span class="anchor" id="line-37"></span>example, here is a mismatch between .41 and .42, which will result in run-time build-id verification errors from systemtap: <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><p class="line867"><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><pre><span class="anchor" id="line-1-2"></span>% uname -r
<span class="anchor" id="line-2-1"></span>3.5.0-26-generic
<span class="anchor" id="line-3-1"></span>% dpkg --list | grep linux
<span class="anchor" id="line-4-1"></span>linux-image-3.5.0-26-generic_3.5.0-26.41_amd64.deb
<span class="anchor" id="line-5-1"></span>linux-image-3.5.0-26-generic-dbgsym_3.5.0-26.42_amd64.ddeb</pre><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><p class="line867">
<h4 id="Ubuntu_9.10_and_higher">Ubuntu 9.10 and higher</h4>
<span class="anchor" id="line-48"></span><p class="line862">Kernel debug packages have been removed from the repositories and moved to a dedicated <a class="http" href="http://ddebs.ubuntu.com/">ddebs repository</a> <span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><ol type="1"><li><p class="line862">From the command line run  <strong>uname -r</strong>  to find your current running kernel version <span class="anchor" id="line-51"></span></li><li><p class="line891"><strong>sudo apt-get install linux-image-$(uname -r)-dbgsym</strong>. If a dbgsym package doesn't exist for your kernel, upgrade your kernel. <span class="anchor" id="line-52"></span></li><li><p class="line862">Systemtap will now have access to nearly all the information it needs, however, <strong>stap -l 'module(&quot;*&quot;).function(&quot;*&quot;)' </strong>, will produce no results. <span class="anchor" id="line-53"></span></li><li>systemtap/libelf is looking for modules with a an extension of .ko.debug, where Ubuntu leaves unstripped kos in /usr/lib/debug with the plain .ko extension. <span class="anchor" id="line-54"></span><ul><li><p class="line891"><strong>sudo apt-get install elfutils</strong>, for eu-readelf <span class="anchor" id="line-55"></span>Then run this script as root, whenever you install additional debug symbols <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><pre><span class="anchor" id="line-1-3"></span>for file in `find /usr/lib/debug -name '*.ko' -print`
<span class="anchor" id="line-2-2"></span>do
<span class="anchor" id="line-3-2"></span>        buildid=`eu-readelf -n $file| grep Build.ID: | awk '{print $3}'`
<span class="anchor" id="line-4-2"></span>        dir=`echo $buildid | cut -c1-2`
<span class="anchor" id="line-5-2"></span>        fn=`echo $buildid | cut -c3-`
<span class="anchor" id="line-6-1"></span>        mkdir -p /usr/lib/debug/.build-id/$dir
<span class="anchor" id="line-7-1"></span>        ln -s $file /usr/lib/debug/.build-id/$dir/$fn
<span class="anchor" id="line-8-1"></span>        ln -s $file /usr/lib/debug/.build-id/$dir/${fn}.debug
<span class="anchor" id="line-9"></span>done</pre><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span></li></ul>This makes available the module probes available and is friendly to other debug symbol savvy apps like gdb and oprofile. This convention should make <span class="anchor" id="line-69"></span><p class="line862">it's way into Ubuntu in the near future. Tracked by <a class="https" href="https://bugs.launchpad.net/ubuntu/+source/systemtap/+bug/669641">lp #669641</a>, this feature is <span class="anchor" id="line-70"></span>already integrated into the Linaro (ARM) kernels. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></li></ol><p class="line867">
<h4 id="Ubuntu_releases_9.04_and_older">Ubuntu releases 9.04 and older</h4>
<span class="anchor" id="line-73"></span><p class="line862">For Gutsy and Hardy, the easiest way is to use the <tt>linux-image-generic</tt> meta-package: <span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line867"><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><pre><span class="anchor" id="line-1-4"></span>sudo apt-get install linux-image-debug-generic</pre><span class="anchor" id="line-78"></span><p class="line862">This will install <tt>/boot/vmlinux-debug-&lt;yourkernelversion&gt;</tt>. Now create a symlink for vmlinux in <tt>/lib/modules</tt>: <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><p class="line867"><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><pre><span class="anchor" id="line-1-5"></span>sudo ln -s /boot/vmlinux-debug-$(uname -r) /lib/modules/$(uname -r)/vmlinux</pre><span class="anchor" id="line-83"></span><p class="line862">For Intrepid, there's no linux-image-debug-generic metapackage (see <a class="https" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/289087);">https://bugs.launchpad.net/ubuntu/+source/linux/+bug/289087);</a> you have to download the right one from <a class="http" href="http://ddebs.ubuntu.com/pool/main/l/linux/">http://ddebs.ubuntu.com/pool/main/l/linux/</a> instead of getting it from APT (unfortunately getting &quot;the right one&quot; is basically impossible, as only the latest version is available for download). After downloading the one of these that matches your kernel, install it with <tt>dpkg&nbsp;-i</tt>.  This will install <tt>/usr/lib/debug/boot/vmlinux-&lt;yourkernelversion&gt;</tt>.  The system already knows to look there for it, so you don't need to symlink it into <tt>/lib/modules</tt>. <span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line867">
<h2 id="Devel_environment">Devel environment</h2>
<span class="anchor" id="line-86"></span><p class="line862">Kernel headers and gcc are needed for module compilation, so if you have not done so, install them (assuming the usage of generic kernel again): libcap-dev needed for Systemtap packages &gt; 0.6-1 <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><p class="line867"><span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><pre><span class="anchor" id="line-1-6"></span>sudo apt-get install linux-headers-generic gcc libcap-dev</pre><span class="anchor" id="line-91"></span><span class="anchor" id="line-92"></span><p class="line867"><strong>Note:</strong> Ubuntu does not currently include utrace support, limiting user space functionality. Once utrace is integrated into the upstream kernel this will no longer be an issue. With version 12.10 (Quantal) and the new Kernel 3.5 there is no need anymore to patch the Kernel. Systemtap can use UPROBES that are integrated into the kernel. For earlier releases such as 12.04 using the latest Mainline 3.5 Kernel (<a class="https" href="https://wiki.ubuntu.com/KernelMainlineBuilds">https://wiki.ubuntu.com/KernelMainlineBuilds</a>) seems to do the trick. <span class="anchor" id="line-93"></span><span class="anchor" id="bottom"></span></div><p id="pageinfo" class="info" lang="en" dir="ltr">None: SystemtapOnUbuntu  (last edited 2013-03-25 01:04:53 by <span title="FChE @ elastic.org[69.20.226.105]"><a href="/systemtap/wiki/FChE" title="FChE @ elastic.org[69.20.226.105]">FChE</a></span>)</p>

<div id="pagebottom"></div>
</div>


<div id="footer">
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onClick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="/systemtap/wiki/SystemtapOnUbuntu?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="/systemtap/wiki/SystemtapOnUbuntu?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/systemtap/wiki/SystemtapOnUbuntu">
<div>
    <label>More Actions:</label>
    <select name="action"
        onchange="if ((this.selectedIndex != 0) &&
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="RenderAsDocbook">Render as Docbook</option>
<option value="refresh">Delete Cache</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="RenamePage" disabled class="disabled">Rename Page</option>
<option value="DeletePage" disabled class="disabled">Delete Page</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Subscribe User</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="show" disabled class="disabled">Remove Spam</option>
<option value="show" disabled class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="show" disabled class="disabled">------------------------</option>
<option value="Load">Load</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    <input type="submit" value="Do">
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

<ul id="credits">
<li><a href="http://moinmo.in/" title="This site uses the MoinMoin Wiki software.">MoinMoin Powered</a></li><li><a href="http://moinmo.in/Python" title="MoinMoin is written in Python.">Python Powered</a></li><li><a href="http://moinmo.in/GPL" title="MoinMoin is GPL licensed.">GPL licensed</a></li><li><a href="http://validator.w3.org/check?uri=referer" title="Click here to validate this page.">Valid HTML 4.01</a></li>
</ul>


</div>
</body>
</html>

